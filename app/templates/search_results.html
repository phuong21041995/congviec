{% extends "base.html" %}
{% block title %}Kết quả tìm kiếm cho '{{ query }}'{% endblock %}

{% block content %}
<header class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="m-0">
        <i class="fa-solid fa-search me-2"></i>
        Kết quả cho: <span class="text-primary">"{{ query }}"</span>
    </h2>
</header>

{% set has_results = results.tasks or results.objectives or results.key_results or results.projects or results.notes or results.files %}

{% if not has_results %}
<div class="alert alert-warning text-center">
    <h4>Không tìm thấy kết quả nào</h4>
    <p class="mb-0">Vui lòng thử với một từ khóa khác.</p>
</div>
{% else %}
    {% if results.projects %}
    <div class="card shadow-sm mb-4">
        <div class="card-header"><h5 class="m-0">Dự án ({{ results.projects|length }})</h5></div>
        <ul class="list-group list-group-flush">
            {% for p in results.projects %}
            <li class="list-group-item">
                <a href="{{ url_for('main.project_workspace', project_id=p.id) }}" class="text-decoration-none">
                    <strong>{{ p.name | replace(query, '<mark>' + query + '</mark>') | safe }}</strong>
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if results.tasks %}
    <div class="card shadow-sm mb-4">
        <div class="card-header"><h5 class="m-0">Công việc ({{ results.tasks|length }})</h5></div>
        <ul class="list-group list-group-flush">
            {% for task in results.tasks %}
            <li class="list-group-item">
                <a href="{{ url_for('main.index', view_mode='day', date_str=task.task_date.strftime('%Y-%m-%d')) }}" class="text-decoration-none">
                    <strong>{{ task.what | replace(query, '<mark>' + query + '</mark>') | safe }}</strong>
                </a>
                <small class="text-muted d-block">Vào ngày {{ task.task_date.strftime('%d/%m/%Y') }}</small>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if results.notes %}
    <div class="card shadow-sm mb-4">
        <div class="card-header"><h5 class="m-0">Ghi chú ({{ results.notes|length }})</h5></div>
        <ul class="list-group list-group-flush">
            {% for note in results.notes %}
            <li class="list-group-item">
                <a href="{{ url_for('main.notes') }}" class="text-decoration-none">
                    <strong>{{ note.title | replace(query, '<mark>' + query + '</mark>') | safe }}</strong>
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if results.files %}
    <div class="card shadow-sm mb-4">
        <div class="card-header"><h5 class="m-0">Files ({{ results.files|length }})</h5></div>
        <ul class="list-group list-group-flush">
            {% for file in results.files %}
            <li class="list-group-item">
                <a href="{{ url_for('main.uploaded_file', filename=file.saved_filename) }}" target="_blank" class="text-decoration-none">
                    <i class="fa-solid fa-download me-2"></i>
                    <strong>{{ file.original_filename | replace(query, '<mark>' + query + '</mark>') | safe }}</strong>
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

{% endif %}
{% endblock %}